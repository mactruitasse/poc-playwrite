# values-prod.yaml

# --- Image n8n custom (pré-bakée avec n8n-nodes-playwright)
image:
  repository: n8n-playwright-local
  tag: "2.2.4-pw1.49.0-fix4"
  pullPolicy: IfNotPresent

# --- Base de données (queue mode => Postgres)
db:
  type: postgresdb

# --- PostgreSQL (subchart)
postgresql:
  enabled: true
  auth:
    database: n8n
    username: n8n
    password: n8n-local-password

# --- Redis (subchart)
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    password: redis-local-password

# --- Queue mode : workers + webhook processors
worker:
  mode: queue
  count: 1
  concurrency: 5
  extraEnv:
    - name: N8N_CUSTOM_EXTENSIONS
      value: "/home/node/.n8n/nodes"
    - name: N8N_COMMUNITY_PACKAGES_ENABLED
      value: "true"
    - name: N8N_UNVERIFIED_PACKAGES_ENABLED
      value: "true"

webhook:
  mode: queue
  count: 1
  # En local (port-forward), tu peux laisser une URL simple.
  # En prod (ingress/domaine), tu mettras l'URL publique des webhooks.
  url: "http://localhost:5678"
  extraEnv:
    - name: N8N_CUSTOM_EXTENSIONS
      value: "/home/node/.n8n/nodes"
    - name: N8N_COMMUNITY_PACKAGES_ENABLED
      value: "true"
    - name: N8N_UNVERIFIED_PACKAGES_ENABLED
      value: "true"

main:
  count: 1
  extraEnv:
    - name: N8N_CUSTOM_EXTENSIONS
      value: "/home/node/.n8n/nodes"
    - name: N8N_COMMUNITY_PACKAGES_ENABLED
      value: "true"
    - name: N8N_UNVERIFIED_PACKAGES_ENABLED
      value: "true"

# --- IMPORTANT : on désactive l'installation de community nodes au runtime
# car le package est déjà dans l'image Docker.
nodes:
  external:
    allowAll: false
    packages: []
    reinstallMissingPackages: false

