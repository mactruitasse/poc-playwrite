# values-prod.yaml

# --- Image n8n custom (pré-bakée avec n8n-nodes-playwright)
image:
  repository: n8n-playwright-local
  tag: "2.2.4-pw1.49.0-fix2"
  pullPolicy: IfNotPresent

# --- Base de données (queue mode => Postgres)
db:
  type: postgresdb

# --- PostgreSQL (subchart)
postgresql:
  enabled: true
  auth:
    database: n8n
    username: n8n
    password: n8n-local-password

# --- Redis (subchart)
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    password: redis-local-password

# --- Queue mode : workers + webhook processors
worker:
  mode: queue
  count: 1
  concurrency: 5
  # IMPORTANT : on désactive la persistence sur /home/node/.n8n pour ne pas masquer les nodes pré-bakés dans l'image
  persistence:
    enabled: false

webhook:
  mode: queue
  count: 1
  # En local (port-forward), tu peux laisser une URL simple.
  # En prod (ingress/domaine), tu mettras l'URL publique des webhooks.
  url: "http://localhost:5678"
  # IMPORTANT : on désactive la persistence sur /home/node/.n8n pour ne pas masquer les nodes pré-bakés dans l'image
  persistence:
    enabled: false

main:
  count: 1
  # IMPORTANT : on désactive la persistence sur /home/node/.n8n pour ne pas masquer les nodes pré-bakés dans l'image
  persistence:
    enabled: false

# --- IMPORTANT : on désactive l'installation de community nodes au runtime
# car n8n-nodes-playwright refuse npm (only-allow pnpm).
# Le package est déjà dans l'image Docker.
nodes:
  external:
    allowAll: false
    packages: []
    reinstallMissingPackages: false
